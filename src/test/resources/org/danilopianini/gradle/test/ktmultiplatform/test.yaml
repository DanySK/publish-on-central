tests:
  - description: "gradle should generate metadata files in kotlin-multiplatform projects"
    configuration:
      tasks: &tasks
        - 'generateMetadataFileForJvmPublication'
        - 'generateMetadataFileForKotlinOSSRHPublication'
        - 'generateMetadataFileForKotlinMultiplatformPublication'
        - 'generateMetadataFileForNativePublication'
        - 'generateMetadataFileForWasm32Publication'
      options:
        - '--stacktrace'
    expectation:
      success: *tasks
  - description: "gradle should generate nexus lifecycle management tasks in multiplatform projects"
    configuration:
      tasks:
        - tasks
    expectation:
      success: tasks
      output_contains:
        - releaseStagingRepositoryOnMavenCentral
        - createStagingRepositoryOnMavenCentral
        - closeStagingRepositoryOnMavenCentral
        - uploadAllPublicationsToMavenCentralNexus
  - description: "dokkaHtml works"
    configuration:
      tasks:
        - dokkaHtml
      options:
        - '--stacktrace'
    expectation:
      success: dokkaHtml
  - description: "javadocJar should rely on dokkaHtml instead of dokkaJavadoc"
    configuration:
      tasks:
        - javadocJar
      options:
        - '--info'
        - '--stacktrace'
    expectation:
      success: dokkaHtml
      not_executed: dokkaJavadoc
      output_contains:
        - "Dokka plugin found, hence javadocJar will be configured"
        - "Lazily configure javadocJar task to depend on Dokka task"
        - "Actually configure javadocJar task to depend on Dokka task dokkaHtml"
